{% extends 'base.html' %}
{% load static %}

{% block title %}Mantenedor de Calificaciones - NUAM{% endblock %}

{% block content %}
<!-- CSRF Token oculto para asegurar que Django establezca la cookie -->
<div style="display: none;">
    {% csrf_token %}
</div>

<div class="container-fluid">
    <!-- Page Header -->
    {% include 'calificaciones/partials/_header.html' %}

    <!-- Content Tabs -->
    {% include 'calificaciones/partials/_tabs_nav.html' %}

    <!-- Tab Content -->
    <div class="tab-content" id="mainTabsContent">
        <!-- Mantenedor Tab -->
        {% if can_view_mantenedor %}
        <div class="tab-pane fade {% if default_active_tab == 'mantenedor' %}show active{% endif %}" id="mantenedor" role="tabpanel">
            <!-- Filtros -->
            {% include 'calificaciones/partials/_filtros.html' %}

            <!-- Tabla de Calificaciones -->
            {% include 'calificaciones/partials/_tabla.html' %}

            <!-- KPIs y Auditoría -->
            {% include 'calificaciones/partials/_kpis_auditoria.html' %}
        </div>
        {% endif %}

        <!-- Cargas Masivas Tab -->
        {% include 'calificaciones/partials/_cargas_masivas.html' %}

        <!-- Usuarios Tab (Solo Administrador) -->
        {% include 'calificaciones/partials/_usuarios.html' %}

        <!-- Auditoría Tab (Administrador y Auditor) -->
        {% include 'calificaciones/partials/_auditoria.html' %}

        <!-- Reportes Tab -->
        <div class="tab-pane fade {% if default_active_tab == 'reportes' %}show active{% endif %}" id="reportes" role="tabpanel">
            {% include 'calificaciones/partials/_reportes.html' %}
        </div>
    </div>
</div>

<!-- Modales de Calificaciones -->
{% include 'calificaciones/partials/_modals_calificaciones.html' %}

<!-- Modales de Usuarios (Solo Administrador) -->
{% include 'calificaciones/partials/_modals_usuarios.html' %}

{% endblock %}

{% block extra_js %}
<script>
    window.USER_ROLES = {
        is_administrador: {{ is_administrador|yesno:"true,false" }},
        is_operador: {{ is_operador|yesno:"true,false" }},
        is_analista: {{ is_analista|yesno:"true,false" }},
        is_consultor: {{ is_consultor|yesno:"true,false" }},
        is_auditor: {{ is_auditor|yesno:"true,false" }},
        user_roles: {{ user_roles_json|safe }}
    };
</script>
<script type="module" src="{% static 'js/mantenedor/init.js' %}"></script>
{% endblock %}
